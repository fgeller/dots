* Version control

  #+begin_src emacs-lisp
    (use-package magit
      :commands (magit-status magit-diff magit-revision-file-log magit-blame-mode)
      :config (define-key magit-status-mode-map (kbd "q") 'magit-quit-session))
  #+end_src

  Helper to get log for a file for a given revision.

  #+begin_src emacs-lisp
    (defun magit-revision-file-log (revision file &optional use-graph)
      "Display the log for the currently visited file or another one from a specific revision.
    With a prefix argument show the log graph."
      (interactive
       (let* ((rev (magit-read-rev "Revision" (or (magit-get-current-branch) "HEAD")))
              (file (magit-read-file-from-rev rev (magit-buffer-file-name t))))
         (list rev file current-prefix-arg)))

      (magit-mode-setup magit-log-buffer-name nil
                        #'magit-log-mode
                        #'magit-refresh-log-buffer
                        'oneline revision
                        `(,@(and use-graph (list "--graph"))
                          ,@magit-custom-options
                          "--follow")
                        file))
  #+end_src

  @magnars magit window session tweaks: Start in fullscreen and restore previous
  window configuration on quit.

  #+begin_src emacs-lisp
    (defadvice magit-status (around magit-fullscreen activate)
      (window-configuration-to-register :magit-fullscreen)
      ad-do-it
      (delete-other-windows))

    (defun magit-quit-session ()
      "Restores the previous window configuration and kills the magit buffer"
      (interactive)
      (kill-buffer)
      (jump-to-register :magit-fullscreen))
  #+end_src

  #+begin_src emacs-lisp
    (add-hook 'vc-annotate-mode-hook (lambda () (setq show-trailing-whitespace nil)))
  #+end_src

  We like word-based diffs.

  #+begin_src emacs-lisp
    (setq magit-diff-refine-hunk t)
  #+end_src

  Enable global magit support for git-wip on save. Don't forget to enable it
  globally for all git repositories:

  =$ git config --global --add magit.extension wip-save=

  #+begin_src emacs-lisp
    (eval-after-load 'magit
      '(progn
         (use-package magit-wip)
         (global-magit-wip-save-mode)))
  #+end_src
