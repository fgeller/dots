* Fingers

  Load key-chord for toggle key.

  #+begin_src emacs-lisp
    (use-package key-chord
      :ensure key-chord
      :init (key-chord-mode 1)
      :config (setq key-chord-two-keys-delay 0.075))
  #+end_src

  Load anzu for visual feedback when replacing text.

  #+begin_src emacs-lisp
    (use-package anzu
      :ensure anzu
      :commands (anzu-query-replace anzu-query-replace-regexp))
  #+end_src

  Load multiple-cursors for light-weight macros.

  #+begin_src emacs-lisp
    (use-package multiple-cursors
      :ensure multiple-cursors
      :commands mc/edit-lines)
  #+end_src

  Load avy for fine-grained in-buffer jumping.

  #+begin_src emacs-lisp
    (use-package avy
      :ensure avy
      :commands (avy-goto-word-or-subword-1))
  #+end_src

  Helper to visualize fingers-mode's state and make mode-line visible.

  #+begin_src emacs-lisp
    (defun fingers-mode-visual-toggle ()
      (interactive)
      (let ((faces-to-toggle '(mode-line mode-line-inactive)))
        (cond (fingers-mode
               (mapcar (lambda (face)
                         (set-face-foreground face "#f8f8f8")
                         (set-face-background face "#f8f8f8")
                         (set-face-attribute face nil :height 20))
                       faces-to-toggle))
              (t
               (mapcar (lambda (face)
                         (set-face-foreground face "#b8b8b8")
                         (set-face-background face "#ffffff")
                         (set-face-attribute face nil :height (face-attribute 'default :height)))
                       faces-to-toggle)))))

    (add-hook 'fingers-mode-hook 'fingers-mode-visual-toggle)
  #+end_src

  Quick helper to trigger offlineimap.

  #+begin_src emacs-lisp
    (defun offlineimap ()
      "Helper to (re)start offlineimap via compile"
      (interactive)
      (let ((buf "*offline-imap*"))
        (if (get-buffer buf)
            (with-current-buffer buf (recompile))
          (compile "offlineimap")
          (with-current-buffer "*compilation*"
            (rename-buffer "*offline-imap*")))))
  #+end_src

  #+begin_src emacs-lisp
    (defun toggle-show-trailing-whitespace ()
      (interactive)
      (setq show-trailing-whitespace (not show-trailing-whitespace)))
  #+end_src

  My custom bindings for fingers-mode.

  #+begin_src emacs-lisp
    (defun fingers-mode-custom-bindings ()
      (interactive)

      (key-chord-define-global "oe" 'global-fingers-mode)

      (define-key fingers-mode-map (kbd "r") 'anzu-query-replace)
      (define-key fingers-mode-map (kbd "R") 'anzu-query-replace-regexp)
      (define-key fingers-mode-map (kbd "H") 'helm-show-kill-ring)
      (define-key fingers-mode-map (kbd "j") 'helm-apropos)
      (define-key fingers-mode-map (kbd "k") 'ag-project)
      (define-key fingers-mode-map (kbd "K") 'ag)
      (define-key fingers-mode-map (kbd "l") 'avy-goto-word-or-subword-1)
      (define-key fingers-mode-map (kbd "L") 'avy-goto-char)
      (define-key fingers-mode-map (kbd ">") 'helm-occur)
      (define-key fingers-mode-map (kbd ".") 'helm-jump)
      (define-key fingers-mode-map (kbd "|") 'mc/edit-lines)
      (define-key fingers-mode-map (kbd "fN") 'window-configuration-to-register)

      (define-key fingers-mode-c-map (kbd "RET") 'browse-url-at-point)

      (define-key fingers-mode-x-map (kbd "f") 'helm-find-files)
      (define-key fingers-mode-x-map (kbd "x") 'helm-M-x)
      (define-key fingers-mode-x-map (kbd "vd") 'magit-diff)
      (define-key fingers-mode-x-map (kbd "vG") 'magit-blame-mode)
      (define-key fingers-mode-x-map (kbd "vs") 'show-eshell-git-status)

      (define-key fingers-mode-launch-map (kbd "e") 'last-eshell)
      (define-key fingers-mode-launch-map (kbd "n") 'notmuch)
      (define-key fingers-mode-launch-map (kbd "oo") 'offlineimap)

      (define-key fingers-mode-toggle-map (kbd "f") 'font-lock-mode)
      (define-key fingers-mode-toggle-map (kbd "w") 'leerzeichen-mode)
      (define-key fingers-mode-toggle-map (kbd "W") 'toggle-show-trailing-whitespace)

      (global-set-key (kbd "s-<up>") 'increase-font-height)
      (global-set-key (kbd "A-<up>") 'increase-font-height)
      (global-set-key (kbd "s-<down>") 'decrease-font-height)
      (global-set-key (kbd "A-<down>") 'decrease-font-height)

      (define-key fingers-mode-map (kbd "S-<up>") 'enlarge-window)
      (define-key fingers-mode-map (kbd "S-<down>") 'shrink-window)
      (define-key fingers-mode-map (kbd "S-<left>") 'shrink-window-horizontally)
      (define-key fingers-mode-map (kbd "S-<right>") 'enlarge-window-horizontally)
      )
  #+end_src

  #+begin_src emacs-lisp
    (eval-after-load 'fingers-mode
      (let* ((my-fingers-map (fingers-mode-clean-map)))
         (define-key my-fingers-map (kbd "ti") 'scala-ignore-all-tests)
         (define-key my-fingers-map (kbd "te") 'scala-enable-all-tests)
         (define-key my-fingers-map (kbd "tn") 'scala-next-test-forward)
         (define-key my-fingers-map (kbd "tp") 'scala-next-test-whitespace)
         (define-key my-fingers-map (kbd "br") 'revert-buffer)
         (define-key my-fingers-map (kbd "bn") 'rename-buffer)
         (define-key my-fingers-map (kbd "bw") 'delete-trailing-whitespace)
         (define-key fingers-mode-map (kbd "q") my-fingers-map)))
  #+end_src

  Load and activate it!

  #+begin_src emacs-lisp
    (use-package fingers
      :commands global-fingers-mode
      :init
      (add-hook 'fingers-after-reset-hook 'fingers-mode-custom-bindings)
      (global-fingers-mode 1))
  #+end_src

  Helper to save macro to =*scratch*= buffer.

  #+begin_src emacs-lisp
    (defun save-macro-to-scratch (name)
      (interactive "SName the macro:")
      (name-last-kbd-macro name)
      (pop-to-buffer "*scratch*")
      (goto-char (point-max))
      (newline)
      (insert ";; generated macro")
      (newline)
      (insert-kbd-macro name)
      (newline))
  #+end_src

  #+begin_src emacs-lisp
    (define-key dired-mode-map (kbd "C-c C-p") 'wdired-change-to-wdired-mode)
  #+end_src

  Unload diff bindings that shadow fingers-mode

  #+begin_src emacs-lisp
    (eval-after-load 'diff-mode
      '(progn
         (dolist (key '("n" "N" "p" "P" "k" "K" "W" "o" "A" "r" "R"))
           (define-key diff-mode-shared-map (kbd key) nil))))
  #+end_src
